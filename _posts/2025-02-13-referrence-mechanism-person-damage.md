---
title: 2.个体机制(1)
description: 介绍了游戏中主要的基本个体机制
author: AAswordsman
date: 2025-02-13 20:09:00 +0800
categories: [C参考, A游戏]
tags: [参考, 机制, 天赋, 等级, 防御, 攻击, 法力值, 攻击间隔]
math: true
mermaid: true
---

这部分内容包括了玩家的伤害机制以及个人基础信息:等级/法力/天赋。

## 等级与法力值

MOD 有独立的等级和经验，和游戏自带的等级不同。**本文档所指的游戏等级无特殊标注均为该等级**。

### 等级

我们简单记等级符号表示为$V_{\text{grade}}$，经验为$V_{\text{experience}}$

等级不会自动提升，需要前往菜单的个人部分，手动升级。

等级和到该等级需要的累计经验公式为：

$$
V_{\text{experience}} = (150 \times (V_{\text{grade}} - 1) ^ 2 + 1050 \times (V_{\text{grade}} - 1) + 900)
$$

### 法力值

我们简单记法力值符号表示为$V_{\text{MP}}$。

上限
: 法力值的默认上限是 `120`（1.9.3R2，老版本是 `200`），有天赋可以提高法力值上限。

回复速度
: 法力值回复速度和**天赋**以及**等级**相关，也可以使用物品/武器和套装快速回复法力值。

定义天赋所带来的加成为$N_{天赋名}$，经验值和等级的关系如下：

法力值回复速度如下(法力值/秒)：

$$
R = \frac{2 \cdot V_{\text{难度加成}}}{5} \cdot \left(1 + \frac{V_{\text{grade}}}{100}\right) \cdot \left(1 + N_{汇流}\right)
$$

## 天赋

### 天赋列表

| 天赋 ID | 名称     | 描述                                                                  | 数值公式                                                      |
| ------- | -------- | --------------------------------------------------------------------- | ------------------------------------------------------------- |
| 1       | **万象** | 生命值增加 `{0}` 点                                                   | 职业天赋：`等级 * 30 / 40`<br>非职业天赋：`等级 * 15 / 40`    |
| 2       | **穿云** | 对 **0~64 距离** 目标造成 `{0}%` 额外伤害，距离越近伤害越小           | 职业天赋：`等级 * 100% / 40`<br>非职业天赋：`等级 * 50% / 40` |
| 3       | **穿甲** | 对目标造成 `{0}% * 20（自身最大生命值）` 额外伤害                     | 职业天赋：`等级 * 25% / 40`<br>非职业天赋：`等级 * 10% / 40`  |
| 4       | **制裁** | 对 **0~16 距离** 目标造成 `{0}%` 额外伤害，距离越远伤害越小           | 职业天赋：`等级 * 50% / 40`<br>非职业天赋：`等级 * 25% / 40`  |
| 5       | **防御** | 受到伤害减免 `{0}%`                                                   | 职业天赋：`等级 * 30% / 40`<br>非职业天赋：`等级 * 15% / 40`  |
| 6       | ~~充能~~ | ~~武器冷却回复加快 `{0}%`~~（已弃用）                                 | 职业天赋：`等级 * 35% / 40`<br>非职业天赋：`等级 * 15% / 40`  |
| 7       | ~~重装~~ | ~~盔甲冷却回复加快 `{0}%`~~（已弃用）                                 | 职业天赋：`等级 * 35% / 40`<br>非职业天赋：`等级 * 15% / 40`  |
| 8       | **汇流** | 法力值回复速度增加 `{0}%`                                             | 职业天赋：`等级 * 100% / 40`<br>非职业天赋：`等级 * 40% / 40` |
| 9       | **突袭** | 攻击造成额外 `{0}%` 伤害，冷却 10 秒                                  | 仅职业天赋生效：`等级 * 80% / 40`                             |
| 10      | **再生** | 每 10 秒为 18 半径内血量最少玩家回复 `{0}` 点血量（敌对模式下不发动） | 仅职业天赋生效：`等级 * 20 / 40`                              |
| 11      | **源泉** | 法力值上限增加 `{0}`                                                  | 职业天赋：`等级 * 80 / 40`<br>非职业天赋：`等级 * 40 / 40`    |

### 职业与天赋关联

| 职业名称            | 职业 ID | 专属天赋 ID | 说明                 |
| ------------------- | ------- | ----------- | -------------------- |
| **守卫 (Guard)**    | 1       | 1, 3        | 高生命值与穿甲伤害   |
| **战士 (Warrior)**  | 2       | 4, 5        | 近战制裁与防御强化   |
| **刺客 (Assassin)** | 3       | 4, 9        | 高爆发突袭与灵活制裁 |
| **弓箭手 (Archer)** | 4       | 2, 3        | 远程穿云与穿甲组合   |
| **术士 (Warlock)**  | 5       | 8, 11       | 法力回复与上限提升   |
| **牧师 (Priest)**   | 6       | 8, 10       | 群体治疗与法力汇流   |

### 特殊规则说明

1. **数值计算**

   - 公式中 `等级` 表示天赋的当前等级，最高等级为 40 级。
   - 职业天赋的数值加成通常是非职业天赋的 **2 倍**（例如：`万象` 职业天赋每级+0.75，非职业+0.375）。

2. **特殊机制**

   - **再生**：在敌对模式下（如 PVP）不会触发治疗。
   - **突袭**：额外伤害有 10 秒冷却时间。
   - **术士 (Warlock)**: 当造成物理伤害时，可以造成额外的魔法伤害，数值和当前法力值挂钩，且法力值大于 100 时才生效。可在[倍率加成系数](#倍率加成系数)中查看具体公式。

3. **弃用天赋**

   - `充能` 和 `重装` 已弃用，可能在未来版本移除。

4. **职业切换**
   - 选择职业后，可以选择**消耗一级等级**进行职业清空。

## 伤害与防御

所有的伤害计算都是基于**基础攻击**,即**你使用某种方式对对方直接造成的伤害**,这包括了抗性/力量/盔甲/武器伤害的折算.

所有的防御计算都是基于**基础伤害值**,即**对方通过某种方式对你造成的伤害**,这包括了抗性/力量/盔甲/武器伤害的折算.

由于这两个值是一样的，我们都采用$D_{\text{base}}$符号表示。

### 伤害分类

**物理伤害类型**

物理伤害类型有：无，铁砧，接触，岩浆，闪电，烟火，
实体攻击、阻挡爆炸、实体爆炸、下落、下落块、飞入墙壁、覆盖、弹射物、活塞、钟乳石、石笋、窒息

$$
\mathbb{P} = \left\{
\begin{aligned}
&\text{none, anvil, contact, magma, lightning, fireworks,} \\
&\text{entityAttack, blockExplosion, entityExplosion, fall,} \\
&\text{fallingBlock, flyIntoWall, override, projectile, piston,} \\
&\text{stalactite, stalagmite, suffocation}
\end{aligned}
\right\}
$$

**魔法伤害类型**

魔法伤害类型有：火，烧灼，熔岩，魔法，冻结，溺水，温度，荆棘，枯萎

$$
\mathbb{M} = \left\{
\begin{aligned}
&\text{fire, fireTick, lava, magic, freezing,} \\
&\text{drowning, temperature, thorns, wither}
\end{aligned}
\right\}
$$

---

### 攻击伤害计算

#### 基础公式框架

最终伤害等于基础伤害乘以伤害放大倍率，再加上额外伤害。

$$
D_{\text{final}} = \underbrace{(D_{\text{base}} \times (1 + \sum F_{\text{mult}}))}_{\text{倍率加成}} + \underbrace{D_{\text{add}}}_{\text{额外加成}}
$$

#### 倍率加成系数

$$
\sum F_{\text{mult}} =  \underbrace{f_{\text{talent}}}_{\text{天赋系数}} +\underbrace{f_{\text{cooling}}}_{\text{攻击间隔系数}} + \underbrace{f_{\text{weapon}}}_{\text{武器系数}} + \underbrace{f_{\text{difficulty}}}_{\text{难度系数}}
$$

其中，天赋加成方面受到多个天赋影响.

定义天赋所带来的加成为$N_{天赋名}$

定义函数$\text{clamp}(a,b,c)=\max(\min(a,c),b)$，用于将数 a 限制在 b 和 c 之间。

**天赋系数:**

这部分其实就是把天赋那些加成算上去，和写的描述是一样的。（不过有一点，穿云天赋太近还是有保底伤害的）

$$
f_{\text{talent}} = \frac{\text{clamp}(d,28,64)}{64} \times N_{穿云} +  \\
\frac{16 - \min(d,16)}{16} \times N_{制裁} + \\
N_{突袭}
$$

需要注意的是，术士的职业加成不在这个计算式子当中，而是当造成非魔法伤害(`magic`)后，在`11tick`(也就是等攻击间隔过了之后)自动造成$\frac{V_{\text{MP}}-100}{100} \times D_{\text{base}}$点魔法伤害。

**攻击间隔系数:**

这其实就是强制玩家去熟悉攻击间隔机制，打早了直接攻击大减。

$$
f_{\text{cooling}} =
\begin{cases}
0.2 & (\text{跳砍 + 有武器+过冷却}) \\
0.1 & (\text{过冷却，但是不满足上一条}) \\
-0.4 & (\text{没过冷却})
\end{cases}
$$

<blockquote class="prompt-info">
当过冷却的攻击击杀一个实体的时候，会触发范围横扫，造成同等量的伤害。（但是暗杀者的技能伤害不会叠上去）
</blockquote>

**武器系数:**

$$
f_{\text{weapon}} =
\begin{cases}
0.2 & (\text{DEC武器}) \\
0 & (\text{其他情况})
\end{cases}
$$

<blockquote class="prompt-danger">
在写这部分内容时我们发现，这部分代码已被注释。
尽管游戏里手持还有+20%的提示，但是实际上加成已被取消。
</blockquote>

**难度系数：**

$$f_{\text{difficulty}} = V_{\text{难度伤害系数}} -1$$

（-1 是因为那个表格里写的是 120%这样的数值，需要操作一下才能得到加成量）

#### 固定加成伤害

一开始是打算用当前血量的，后来发现，简单模式下这个简直逆天，所以直接锁死 20，不算难度加成了。

装备加成指的是全身上下叠起来，以及手中武器写的。

$$
D_{\text{add}} = (20 + N_{万象}) \times N_{破甲} + \\
 D_\text{装备加成}
$$

---

### 防御减伤计算

防御的计算较为复杂，涉及到了多段的伤害减免。下面将进行解释。

我们记$R_{\text{resistance}}$和$A_{\text{defense}}$分别为盔甲抗性和盔甲防御，$A_{\text{protection}}$和$A_{\text{resilience}}$为盔甲值和韧性值。

#### 盔甲韧性模拟

MOD 的韧性计算不跟随原版，而是独立计算。韧性将会以百分比减免的方式进行。
这个数据可以充当一个韧性的模拟(因为是拟合官方那个多段数据做的)。

$$
R_\%=\frac{-(4 \times A_{protection} \times A_{resilience}) }{(A_{resilience} + 8) \times (A_{protection} - 125)}
$$

$$D'_{\text{base}} = D_{\text{base}} \times (1-R_\%)$$

只在伤害源为物理伤害，即$D_{\text{type}} \in \mathbb{M}$时进行此计算。

#### 减伤流程

<blockquote class="prompt-warning">
注意：法术类型伤害和物理类型伤害是分别计算的。
</blockquote>

先减去防御的数值，然后再进行百分比的减免。

$$
D''_{\text{base}} = (D'_{\text{base}}-A_{\text{defense}})\times (1-R_{\text{resistance}})
$$

接着再分别进行物理和法术的难度减免，以及天赋减免。

$$
D'''_{\text{base}} = D''_{\text{base}}\times (1-V_{\text{难度防御加成}})\times (1-N_{\text{防御}})
$$

然后，会用这个数值尝试去消耗魔法/物理护盾，得到最终伤害。

$$
D_{\text{final}} = g(D'''_{\text{base}})
$$
